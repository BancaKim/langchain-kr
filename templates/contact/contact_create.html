{% include 'header.html' %}

{% block head %}
<link rel="stylesheet" href="/static/css/style.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
{% endblock %}

{% block content %}
<section class="create">
    <div class="container">
        <div class="page-title">
            <h3>섭외등록 글 작성</h3>
        </div>

        <form id="contactForm" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label for="username">작성자</label>
                <input type="text" class="form-control" id="username" name="username" value="{{ username }}" readonly>
            </div>
            <div class="form-group">
                <label for="title">제목</label>
                <input type="text" id="title" name="title" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="content">내용</label>
                <textarea id="content" name="content" rows="5" class="form-control" required></textarea>
            </div>
            <div class="form-group">
                <label for="file">파일 첨부 (선택 사항)</label>
                <input type="file" id="file" name="file" class="form-control">
            </div>
            <div class="form-group">
                <label for="corporation_name">법인명</label>
                {% if corporation_name %}
                <input type="text" id="corporation_name" name="corporation_name" class="form-control" value="{{ corporation_name }}" readonly>
                {% else %}
                <input type="text" id="corporation_name" name="corporation_name" class="form-control" required>
                {% endif %}
            </div>        
            <div class="btn-wrap">
                <button type="button" class="btn btn-dark" onclick="handleSubmit()">등록</button>
                <button type="button" onclick="location.href='/contact'" class="btn btn-dark">목록으로</button>
            </div>
        </form>
    </div>
</section>

<script>
    function handleSubmit() {
        Swal.fire({
            title: '섭외등록이 완료되었어요. 본부장님께 등록내역 송부도 진행할까요?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: '예',
            cancelButtonText: '아니오'
        }).then((result) => {
            if (result.isConfirmed) {
                // 사용자가 '예'를 클릭한 경우 이메일 전송 플래그를 설정하고 폼 제출
                const form = document.getElementById('contactForm');
                const emailInput = document.createElement('input');
                emailInput.type = 'hidden';
                emailInput.name = 'send_email_flag';
                emailInput.value = 'true';
                form.appendChild(emailInput);
                form.submit();
            } else {
                // 사용자가 '아니오'를 클릭한 경우 이메일 전송 플래그 없이 폼 제출
                document.getElementById('contactForm').submit();
            }
        });
    }
</script>
{% endblock %}
{% include 'footer.html' %}
