{% include 'header.html' %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const streamContent = document.getElementById('streamContent');

        async function fetchContent() {
            // SweetAlert2를 사용하여 5초 동안 로딩 화면 표시
            await Swal.fire({
                title: 'AI 심사보고서 생성중',
                html: '잠시만 기다려주세요...',
                timer: 5000,
                timerProgressBar: true,
                allowOutsideClick: false,
                showConfirmButton: false,
                willOpen: () => {
                    Swal.showLoading();
                }
            });

            try {
                const response = await fetch('/credit/stream-content/{{reportContent.rcept_no}}');
                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    const chunk = decoder.decode(value, { stream: true });
                    streamContent.innerHTML += chunk;
                }
            } catch (error) {
                console.error('Error:', error);
                streamContent.textContent = '내용을 불러오는 중 오류가 발생했습니다.';
                // 오류 발생 시 alert 표시
                Swal.fire({
                    icon: 'error',
                    title: '오류 발생',
                    text: '심사보고서를 불러오는 중 문제가 발생했습니다.'
                });
            }
        }

        fetchContent();
    });
</script>
<style>
    #streamContent {
        white-space: pre-wrap;
        word-break: break-word;
    }
</style>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://cdn.jsdelivr.net/npm/flowbite@2.4.1/dist/flowbite.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="/static/css/font.css">
{% endblock %}



{% block content %}
<div class="bg-purple-100">
    <div class="rounded-lg p-8 w-9/12 mx-auto">

        <span class="block text-left text-xl mb-2">
            <a href="/" class="mr-2">홈</a> &nbsp; | &nbsp;
            <a href="/credit/creditReview" class="ml-2">AI심사보고서</a> &nbsp; | &nbsp;
            <span>종합의견</span>
        </span>
        <br><br><br><br>


        <div class="text-center mb-4">
            <h1 class="text-5xl font-bold">심사보고서 종합의견</h1>
            <h2></h2>
        </div>
        <br><br><br><br>
    </div>
</div>
<br>

<div class="container mx-auto my-8 px-6">
    <div class="flex flex-col md:flex-row gap-12">
        <!-- 기업정보 영역 -->
        <div class="flex-1 bg-white rounded-lg shadow-lg">
            <div class="bg-gray-100 border-b border-gray-300 p-3 rounded-t-lg">
                <h2 class="text-xl font-semibold text-gray-800">기업정보</h2>
            </div>
            <div class="p-6">
                <p class="mb-2 text-gray-700"><strong>순서:</strong> {{reportContent.report_num}}</p>
                <p class="mb-2 text-gray-700"><strong>회사코드:</strong> {{reportContent.corp_code}}</p>
                <p class="mb-2 text-gray-700"><strong>회사명:</strong> {{reportContent.corp_name}}</p>
                <p class="mb-2 text-gray-700"><strong>보고서명:</strong> {{reportContent.report_nm}}</p>
                <p class="mb-2 text-gray-700"><strong>보고서번호:</strong> {{reportContent.rcept_no}}</p>
            </div>
        </div>

        <!-- 심사보고서 영역 -->
        <div class="flex-1 bg-white rounded-lg shadow-lg">
            <div class="bg-gray-100 border-b border-gray-300 p-3 rounded-t-lg">
                <h2 class="text-xl font-semibold text-gray-800">종합의견</h2>
            </div>
            <div id="streamContent" class="p-6">
            </div>
        </div>
    </div>
</div>

<style>
    .container {
        max-width: 80%;
    }

    .min-h-600 {
        min-height: 600px;
    }
</style>

<br><br>

<div class="btn-group my-4 flex justify-center">
    <button onclick="history.back()"
        class="px-4 py-2 text-white rounded-md hover:bg-[#6a46b0] focus:ring-4 focus:ring-[#9a7ce0] focus:outline-none"
        style="background-color: #7F56D9;">
        뒤로가기
    </button>

    &nbsp; &nbsp; &nbsp; &nbsp;

    <button onclick="history.back()"
        class="px-4 py-2 text-white rounded-md hover:bg-[#6a46b0] focus:ring-4 focus:ring-[#9a7ce0] focus:outline-none"
        style="background-color: #7F56D9;">
        바로등급
    </button>

</div>

<br><br><br><br>

{% endblock %}

{% include 'footer.html' %}